<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NYC Vibes JS</title>
    <link rel="icon" type="image/png" href="static/favicon.png">
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #000;
        }
    </style>
</head>
<body>
<script type="module">
    import kaboom from 'https://unpkg.com/kaboom@3000.0.0/dist/kaboom.mjs';
    import { createStartScene } from './src/js/scenes/start.js';
    import { createMainScene } from './src/js/scenes/city.js';
    import { createEndScene } from './src/js/scenes/end.js';
    import { WIN_VIBES, LOSE_VIBES } from './src/js/config/constants.js';

    // Load assets
    const loadAssets = async () => {
        try {
            // Load background sprites
            await Promise.all([
                loadSprite("start", "static/start_screen.jpg"),
                loadSprite("win_screen", "static/win_screen.jpg"),
                loadSprite("lose_screen", "static/lose_screen.jpg"),
                loadSprite("map", "static/NYCmap.jpg")
            ]);

            // Load character sprites
            await Promise.all([
                loadSprite("player", "static/KJK.png"),
                loadSprite("devil", "static/devil.png")
            ]);

            // Load sounds
            await Promise.all([
                loadSound("bgm", "static/bg_music.mp3"),
                loadSound("positive", "static/positive.wav"),
                loadSound("negative", "static/negative.wav"),
                loadSound("dark", "static/dark.mp3"),
                loadSound("boom", "static/boom.wav")
            ]);

            // Load item sprites
            const itemSprites = [
                "dog", "poop", "pizza", "pretzel", "bagels", "coffee",
                "museum", "tourist", "edible", "grenade", "sun",
                "construction", "rain", "taxi", "subway"
            ];
            await Promise.all(
                itemSprites.map(spriteName => 
                    loadSprite(spriteName, `static/${spriteName}.png`)
                )
            );

            // Create scenes after assets are loaded
            scene("start", createStartScene());
            scene("game", createMainScene());
            scene("win", createEndScene());
            scene("lose", createEndScene());

            // Start the game
            go("start");
        } catch (error) {
            console.error("Failed to load assets:", error);
            // Show error message to user
            add([
                text("Failed to load game assets. Please refresh the page.", {
                    size: 24,
                    font: "sans-serif"
                }),
                pos(center),
                anchor("center"),
                color(255, 0, 0),
                fixed()
            ]);
        }
    };

    // Initialize game and expose all functions globally
    const k = kaboom({
        width: 1024,
        height: 768,
        background: [0, 0, 0],
        global: true,
        debug: true
    });

    // Start loading assets
    loadAssets();
</script>
</body>
</html>
